{% extends "layout.html" %} {% block content %}

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<div class="row mb-4">
  <div class="col-12 text-center">
    <h2 class="fw-bold text-primary">
      <i class="fa-solid fa-microscope me-2"></i>DetaylÄ± Veri Analizi
    </h2>
    <p class="text-muted">
      FiyatÄ± etkileyen faktÃ¶rlerin gÃ¶rsel, sayÄ±sal ve akademik analizi.
    </p>
  </div>
</div>

<ul class="nav nav-tabs nav-justified mb-3" id="analysisTab" role="tablist">
  <li class="nav-item">
    <button
      class="nav-link active"
      id="visual-tab"
      data-bs-toggle="tab"
      data-bs-target="#visual"
      type="button"
    >
      <i class="fa-solid fa-eye me-1"></i>GÃ¶rsel Analiz (IsÄ± HaritasÄ±)
    </button>
  </li>

  <li class="nav-item">
    <button
      class="nav-link"
      id="tables-tab"
      data-bs-toggle="tab"
      data-bs-target="#tables"
      type="button"
    >
      <i class="fa-solid fa-table me-1"></i>Korelasyon TablolarÄ±
    </button>
  </li>

  <li class="nav-item">
    <button
      class="nav-link"
      id="report-tab"
      data-bs-toggle="tab"
      data-bs-target="#report"
      type="button"
    >
      <i class="fa-solid fa-book-open me-1"></i>Akademik Rapor
    </button>
  </li>
</ul>

<div
  class="tab-content p-4 border border-top-0 bg-white shadow-sm rounded-bottom"
>
  <div class="tab-pane fade show active" id="visual">
    <h5 class="fw-bold text-dark mb-3">ğŸ“¢ FiyatÄ± En Ã‡ok Etkileyen FaktÃ¶rler</h5>
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card border-success h-100">
          <div class="card-header bg-success text-white">
            <i class="fa-solid fa-arrow-trend-up me-2"></i>FiyatÄ± ARTIRAN Ä°lk 3
            FaktÃ¶r
          </div>
          <ul class="list-group list-group-flush">
            {% for feature, score in influencers.pozitif.items() %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              <strong>{{ feature }}</strong>
              <span class="badge bg-success rounded-pill"
                >+{{ "%.2f"|format(score) }}</span
              >
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card border-danger h-100">
          <div class="card-header bg-danger text-white">
            <i class="fa-solid fa-arrow-trend-down me-2"></i>FiyatÄ± DÃœÅÃœREN Ä°lk
            3 FaktÃ¶r
          </div>
          <ul class="list-group list-group-flush">
            {% for feature, score in influencers.negatif.items() %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              <strong>{{ feature }}</strong>
              <span class="badge bg-danger rounded-pill"
                >{{ "%.2f"|format(score) }}</span
              >
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <hr />

    <h5 class="fw-bold text-dark mb-3">ğŸ”¥ Korelasyon IsÄ± HaritasÄ± (Heatmap)</h5>
    <div class="card shadow-sm">
      <div class="card-body p-1">
        <div id="heatmapPlot" style="width: 100%; height: 600px"></div>
      </div>
      <div class="card-footer small text-muted text-center">
        * SarÄ±/KÄ±rmÄ±zÄ± tonlar gÃ¼Ã§lÃ¼ iliÅŸkiyi, Mavi/Mor tonlar dÃ¼ÅŸÃ¼k iliÅŸkiyi
        gÃ¶sterir.
      </div>
    </div>
  </div>

  <div class="tab-pane fade" id="tables">
    <h5 class="text-primary fw-bold mb-3">Kategorik Ä°liÅŸkiler (Cramer's V)</h5>
    <div class="row mb-4">
      {% for key, value in cat_corr.items() %}
      <div class="col-md-4 mb-3">
        <div
          class="card border-{{ 'primary' if value > 0.3 else 'secondary' }}"
        >
          <div
            class="card-body d-flex justify-content-between align-items-center py-2"
          >
            <span class="fw-bold">{{ key }}</span>
            <span
              class="badge bg-{{ 'primary' if value > 0.3 else 'secondary' }}"
              >{{ value }}</span
            >
          </div>
          <div class="progress" style="height: 3px">
            <div
              class="progress-bar bg-{{ 'primary' if value > 0.3 else 'secondary' }}"
              style="width: {{ value * 100 }}%"
            ></div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <hr />

    <h5 class="text-primary fw-bold mb-3">SayÄ±sal Korelasyon Matrisleri</h5>
    <div class="accordion" id="corrAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button
            class="accordion-button"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#pearsonTable"
          >
            <strong>Pearson (DoÄŸrusal)</strong>
          </button>
        </h2>
        <div
          id="pearsonTable"
          class="accordion-collapse collapse show"
          data-bs-parent="#corrAccordion"
        >
          <div class="accordion-body table-responsive small-font">
            {{ pearson_corr | safe }}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#spearmanTable"
          >
            <strong>Spearman (SÄ±ralÄ±/Rank)</strong>
          </button>
        </h2>
        <div
          id="spearmanTable"
          class="accordion-collapse collapse"
          data-bs-parent="#corrAccordion"
        >
          <div class="accordion-body table-responsive small-font">
            {{ spearman_corr | safe }}
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#kendallTable"
          >
            <strong>Kendall's Tau</strong>
          </button>
        </h2>
        <div
          id="kendallTable"
          class="accordion-collapse collapse"
          data-bs-parent="#corrAccordion"
        >
          <div class="accordion-body table-responsive small-font">
            {{ kendall_corr | safe }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane fade" id="report">
    <div class="card border-{{ consistency.renk }} mb-4">
      <div class="card-header bg-{{ consistency.renk }} text-white fw-bold">
        <i class="fa-solid fa-scale-balanced me-2"></i>YÃ¶ntemler ArasÄ±
        TutarlÄ±lÄ±k Analizi
      </div>
      <div class="card-body">
        <div class="row text-center align-items-center">
          <div class="col-md-4">
            <small class="text-muted d-block">Pearson vs Spearman FarkÄ±</small>
            <h2 class="fw-bold">{{ consistency.fark }}</h2>
          </div>
          <div class="col-md-4 border-start border-end">
            <small class="text-muted d-block">Benzerlik OranÄ±</small>
            <h2 class="fw-bold text-{{ consistency.renk }}">
              % {{ consistency.yuzde }}
            </h2>
          </div>
          <div class="col-md-4 text-start">
            <small class="text-muted d-block">Yapay Zeka Yorumu:</small>
            <p class="mb-0 fw-bold">{{ consistency.yorum }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header fw-bold bg-light">
            Neden FarklÄ± YÃ¶ntemler?
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush small">
              <li class="list-group-item">
                <strong>Pearson:</strong> Veriler normal daÄŸÄ±lÄ±yorsa en
                iyisidir. Outlier'a karÅŸÄ± Ã§ok hassastÄ±r.
              </li>
              <li class="list-group-item">
                <strong>Spearman:</strong> Veriler sÄ±ralÄ±ysa (Ordinal) veya uÃ§
                deÄŸerler (Outlier) Ã§oksa kullanÄ±lÄ±r.
              </li>
              <li class="list-group-item">
                <strong>Kendall:</strong> KÃ¼Ã§Ã¼k veri setlerinde Spearman'dan
                daha gÃ¼venilirdir.
              </li>
              <li class="list-group-item">
                <strong>Cramer's V:</strong> Marka, Renk gibi sÃ¶zel verilerin
                iliÅŸkisini Ã¶lÃ§er.
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header fw-bold bg-light">KullanÄ±lan Modeller</div>
          <div class="card-body">
            <p class="small">
              <strong>Random Forest Regressor:</strong> Fiyat tahmini iÃ§in
              kullanÄ±ldÄ±. 200 adet karar aÄŸacÄ± iÃ§erir. Tek bir formÃ¼l yerine
              binlerce olasÄ±lÄ±ÄŸÄ± deÄŸerlendirdiÄŸi iÃ§in "uÃ§uk rakamlar"
              (Overfitting) Ã¼retmez.
            </p>
            <p class="small">
              <strong>Z-Score Outlier Detection:</strong> Modelin tahmin
              hatasÄ±nÄ±n standart sapmasÄ± hesaplanarak, Â±1.5 sapma gÃ¶steren
              araÃ§lar "FÄ±rsat" veya "KazÄ±k" olarak etiketlendi.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  var zValues = {{ heatmap_data.z | tojson }};
  var xValues = {{ heatmap_data.x | tojson }};
  var yValues = {{ heatmap_data.y | tojson }};

  var data = [{
      z: zValues,
      x: xValues,
      y: yValues,
      type: 'heatmap',
      colorscale: 'Viridis',
      hoverongaps: false
  }];

  var layout = {
      title: 'DeÄŸiÅŸkenler ArasÄ± Ä°liÅŸki Matrisi',
      margin: {l: 100, b: 100},
      responsive: true
  };

  Plotly.newPlot('heatmapPlot', data, layout);
</script>

{% endblock %}
